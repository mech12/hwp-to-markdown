# HWP to Markdown 구현 계획

## 개요

HWP 파일을 Markdown으로 변환하는 Python 라이브러리 구현

- 파이프라인: HWP → HTML (pyhwp/hwp5html) → Markdown (markdownify)

## 기술 조사 결과

- **pyhwp**: CLI 도구 `hwp5html`을 제공, Python API는 제한적 → subprocess로 호출
- **markdownify**: Python API 사용 가능 (`from markdownify import markdownify`)

## 프로젝트 구조

```
hwp-to-markdown/
├── pyproject.toml          # uv 패키지 설정
├── README.md               # (기존)
├── LICENSE                 # MIT 라이선스
├── src/
│   └── hwp_to_markdown/
│       ├── __init__.py     # convert 함수 export
│       ├── converter.py    # 핵심 변환 로직
│       └── cli.py          # CLI (hwp2md)
├── tests/
│   ├── __init__.py
│   └── test_converter.py   # 테스트
└── docs/
    ├── 구현계획.md          # 이 파일
    ├── 중간결과.md          # 중간 진행 상황
    ├── 최종결과.md          # 최종 결과
    └── sample-data/        # 샘플 HWP 파일
```

## 구현 순서

### 1. pyproject.toml 생성

- 패키지 메타데이터
- 의존성: pyhwp, markdownify
- CLI 엔트리포인트: `hwp2md`
- dev 의존성: pytest

### 2. src/hwp_to_markdown/converter.py

핵심 변환 로직:

```python
def hwp_to_html(hwp_path: str) -> str:
    """hwp5html CLI를 subprocess로 호출하여 HTML 생성"""

def html_to_markdown(html: str) -> str:
    """markdownify로 HTML → Markdown 변환"""

def convert(hwp_path: str, output: str = None) -> str:
    """메인 변환 함수 (README API와 일치)"""
```

### 3. src/hwp_to_markdown/cli.py

argparse 기반 CLI:

- `hwp2md document.hwp` - stdout 출력
- `hwp2md document.hwp -o output.md` - 파일 저장
- `hwp2md *.hwp --output-dir ./md/` - 일괄 변환

### 4. src/hwp_to_markdown/__init__.py

```python
from .converter import convert
__all__ = ["convert"]
```

### 5. tests/test_converter.py

- 샘플 HWP 파일 변환 테스트
- HTML → Markdown 변환 테스트

### 6. LICENSE

MIT 라이선스 파일

## 주요 구현 사항

### hwp5html 호출 방식

```python
import subprocess
import tempfile

def hwp_to_html(hwp_path: str) -> str:
    with tempfile.TemporaryDirectory() as tmpdir:
        result = subprocess.run(
            ["hwp5html", "--output", tmpdir, hwp_path],
            capture_output=True, text=True
        )
        # tmpdir 내 HTML 파일 읽기
        html_file = Path(tmpdir) / "index.xhtml"
        return html_file.read_text()
```

### markdownify 옵션

```python
from markdownify import markdownify

def html_to_markdown(html: str) -> str:
    return markdownify(html, heading_style="ATX", strip=["script", "style"])
```

### 이미지 처리 (별도 폴더 추출)

```python
def extract_images(html_dir: Path, output_dir: Path) -> dict:
    """HTML 디렉토리에서 이미지를 output_dir/images/로 복사하고 경로 매핑 반환"""
    images_dir = output_dir / "images"
    images_dir.mkdir(exist_ok=True)
    # bindata/ 폴더 내 이미지 파일들을 복사
    # HTML 내 이미지 경로를 상대 경로로 변환
```

## 생성할 파일 목록

1. `pyproject.toml`
2. `src/hwp_to_markdown/__init__.py`
3. `src/hwp_to_markdown/converter.py`
4. `src/hwp_to_markdown/cli.py`
5. `tests/__init__.py`
6. `tests/test_converter.py`
7. `LICENSE`
